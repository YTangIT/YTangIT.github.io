!function ($) {
    /***
     * 支持检测浏览器及版本信息
     * Chrome/Safari/Firefox/IE
     ***/
    window.BO = {
        wekit: true,
        Chrome: false,
        Safari: false,
        Firefox: false,
        Opera: false,
        IE: false, //IE9-10
        oldIE: false, //IE6~-8
        newIE: false, //IE11
        iDevice: false,
        iPhone: false,
        iPad: false,
        android: false,
        name: 'unkonwn',
        version: ''
    };

    /*
     * 工具：发布订阅模式（观察者模式）
     */
    !function (global, factory) {
        if(typeof exports === 'object' && typeof module !== 'undefined') {
            module.exports = factory()
        } else if (typeof define === 'function' && define.amd) {
            define([], factory)
        } else {
            global.observer = factory();
        }
    }(typeof window !== "undefined" ? window : this, function () {
        /**
         * 观察者模式构造函数
         * 功能描述：实现基本的观察者（订阅/发布）模式功能，并支持晚订阅（先发布后订阅同样能收到发布的数据）。
         * @constructor
         */
        function Observer(initData) {
            this.data = null;
            this.oldData = null;
            this.subscribers = {};
            this.anonymous = [];

            if(typeof initData !== 'undefined') {
                this.publish(null, initData);
            }
        }

        /**
         * 订阅方法
         * @param name 字符串 订阅者名字
         * @param callback 函数 有新发布时执行的方法
         * @returns {Observer} 返回实例本身
         */

        Observer.prototype.subscribe = function (name, callback) {
            if (name === null) {
                this.anonymous.push(callback)
            } else {
                this.subscribers[name] = callback;
            }

            if (this.data !== null) {
                // 晚订阅接收消息
                callback.call(this, this.data);
            }
            return this
        };

        /**
         * 退订阅方法
         * @param name 字符串 退订阅者名字
         * @returns {Observer} 返回实例本身
         */
        Observer.prototype.unsubscribe = function (name) {
            if (this.subscribers[name] !== undefined) {
                delete this.subscribers[name];
            }
            return this
        };

        /**
         * 发布方法
         * @param name 字符串 发布者名字
         * 参数描述：传入发布者名字时，若发布者同时是订阅者，那他对应的方法将不再重复执行。
         * 若需要执行每一个订阅者的方法，则传入null。
         * @param data null以外任意类型 发布的数据
         * @returns {Observer} 返回实例本身
         */
        Observer.prototype.publish = function (name, data) {
            this.oldData = this.data;
            this.data = data;

            for (var key in this.subscribers) {

                if (name === null || name !== key) {
                    this.subscribers[key].call(this, data);
                }
            }

            for (var i = 0; i < this.anonymous.length; i++) {
                this.anonymous[i].call(this, data)
            }

            return this
        };

        Observer.prototype.getData = function () {
            return this.data;
        };

        Observer.prototype.getOldData = function () {
            return this.oldData;
        };

        // 暴露接口
        var observers = {};

        var observer = function (observerName, init, initData) {
            var instance = observer.get(observerName);

            if(instance) {
                return instance;
            } else if(init) {
                return observer.init(observerName, initData);
            }
        };

        observer.get = function (observerName) {
            return observers[observerName]
        };

        observer.init = function (observerName, initData) {
            return observers[observerName] = new Observer(initData);
        };

        observer.constructor = Observer;

        return observer
    });

    (function () {
        "use strict";

        var uaInfo = navigator.userAgent;
        BO.getUAInfo = function () {
            return uaInfo;
        }
        BO.init = function () {
            BO.detectBrowser();
            BO.detectDevice();
        };

        BO.detectBrowser = function () {
            var regF = /Firefox[\/\s](\d+\.\d+)/, //Firefox
                regO = /Opera|OPR[\/\s](\d+\.\d+)/, //Opera
                regI = /MSIE[\/\s](\d+\.\d+)/, //IE6-10
                regC = /Chrome[\/\s](\d+\.\d+)/, //Chrome
                regS = /Safari[\/\s](\d+\.\d+)/, //Safari
                regIn = /rv[\:\s](\d+\.\d+).*like Gecko/; //IE11
            BO.Firefox = regF.test(uaInfo);
            BO.Opera = regO.test(uaInfo);
            BO.Chrome = regC.test(uaInfo);
            BO.Safari = !BO.Chrome && regS.test(uaInfo);

            BO.newIE = regIn.test(uaInfo);
            BO.IE = BO.newIE || regI.test(uaInfo);
            BO.oldIE = BO.IE && !BO.newIE && Number(uaInfo.match(regI)[1]) < 9;

            var regSV = /Version\/(\d+.\d+.\d+)/;
            BO.Chrome && (BO.name = 'Chrome') && (BO.version = uaInfo.match(regC) && uaInfo.match(regC)[1]);
            BO.Firefox && (BO.name = 'Firefox') && (BO.version = uaInfo.match(regF) && uaInfo.match(regF)[1]);
            BO.Safari && (BO.name = 'Safari') && (BO.version = uaInfo.match(regSV) && uaInfo.match(regSV)[1]);
            BO.Opera && (BO.name = 'Opera') && (BO.version = uaInfo.match(regO) && uaInfo.match(regO)[1]);
            BO.IE && (BO.name = 'IE') && (BO.version = BO.newIE ? (uaInfo.match(regIn) && uaInfo.match(regIn)[1]) : (uaInfo.match(regI) && uaInfo.match(regI))[1]);

            BO.webkit = !(BO.Firefox || BO.Opera || BO.IE);

        };
        BO.detectDevice = function () {
            var ua = uaInfo.toLowerCase();
            BO.android = ua.indexOf('android') > -1;

            (/iPad/i).test(uaInfo) && (BO.iPad = true) && (BO.iDevice = true);
            (/iPhone|iPod/i).test(uaInfo) && (BO.iPhone = true) && (BO.iDevice = true);
        }

    })();
// 子元素scroll父元素容器不跟随滚动
    $.fn.scrollUnique = function () {
        return $(this).each(function () {
            var eventType = 'mousewheel';
            // 火狐是DOMMouseScroll事件
            if (document.mozHidden !== undefined) {
                eventType = 'DOMMouseScroll';
            }
            $(this).on(eventType, function (event) {
                // 一些数据
                var scrollTop = this.scrollTop,
                    scrollHeight = this.scrollHeight,
                    height = this.clientHeight;

                var delta = (event.originalEvent.wheelDelta) ? event.originalEvent.wheelDelta : -(event.originalEvent.detail || 0);
                delta = delta / 5;
                if ((delta > 0 && scrollTop <= delta) || (delta < 0 && scrollHeight - height - scrollTop <= -1 * delta)) {
                    // IE浏览器下滚动会跨越边界直接影响父级滚动，因此，临界时候手动边界滚动定位
                    this.scrollTop = delta > 0 ? 0 : scrollHeight;
                    // 向上滚 || 向下滚
                    event.preventDefault();
                }
            });
        });
    };
    (function () {
        var lastTime = 0;
        var vendors = ['webkit', 'moz'];
        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || // Webkit中此取消方法的名字变了
                window[vendors[x] + 'CancelRequestAnimationFrame'];
        }

        if (!window.requestAnimationFrame) {
            window.requestAnimationFrame = function (callback, element) {
                var currTime = new Date().getTime();
                var timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
                var id = window.setTimeout(function () {
                    callback(currTime + timeToCall);
                }, timeToCall);
                lastTime = currTime + timeToCall;
                return id;
            };
        }
        if (!window.cancelAnimationFrame) {
            window.cancelAnimationFrame = function (id) {
                clearTimeout(id);
            };
        }
    }());
    jQuery.extend(jQuery.easing, {
        easeOutSine: function (x, t, b, c, d) {
            return c * Math.sin(t / d * (Math.PI / 2)) + b;
        }
    });
    $(function () {
        // 浏览器、终端检测
        BO.init();
        BO.oldIE && $("body").addClass('oldIE');
        BO.iDevice && $("body").addClass('Mobile');
        // IE8及以下浏览器提示升级信息

        if (BO.oldIE && !localStorage.getItem("hideCompatible")) {
            $("body").addClass('Compatible');
        }
        ;

        var win_width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,
            win_height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

        var $frame = $("body");
        $(window).scroll(function (event) {
            if (!$("#header").hasClass('loaded')) {
                return
            }
            ;
            var currTop = $(window).scrollTop();
            if (currTop <= 30) {
                $frame.removeClass('scrolled')
            } else {
                $frame.addClass('scrolled')
            }

            if (currTop > win_height) {
                $(".float-sidebar").addClass('show-totop');
            } else {
                $(".float-sidebar").removeClass('show-totop');
            }
            $(".float-sidebar").removeClass('show');
        });
        if (win_width < 1024) {
            $(".float-sidebar").on('click', '.shown-btn', function (event) {
                $(this).closest('.float-sidebar').addClass('show');
            });
            $(".help-header").addClass("hide");
            //$(".help-header .navigation .nav-item.search-item").removeClass("search-acting");

        }
        var $header = $("#header");

        //设置每个子菜单初始top值
        function setSubNav() {
            $(".subnav-layer").each(function (index, el) {
                $(this).css('top', $(this).height() * -1);
            });
        }

        headerFun();

        function headerFun() {
            $header.addClass('loaded');
            // 设置每个子菜单初始top值
            if (win_width < 1024) {
                $(".help-header .navigation .nav .nav-item").removeClass("hide");
                //$(".help-header .navigation .nav-item.search-item").removeClass("search-acting");
            }

            var selIndex = String($header.data('on')).split(",");
            $header.find('.nav-item').eq(selIndex[0]).addClass('action').find('.sub-item').eq(selIndex[1]).addClass('action');

            $('.compatibility .close-large').on('click', function (event) {
                $('body').removeClass('Compatible');
                localStorage.setItem("hideCompatible", true);
            });

            if ($('.header-banner').length > 0) {
                var imgSrc = '';
                if (win_width >= 800) {
                    imgSrc = $('.header-banner-bg img.pc-bg').attr('src');
                } else {
                    imgSrc = $('.header-banner-bg img.mb-bg').attr('src');
                }
                $('.header-banner .header-banner-bg').css('background-image', 'url(' + imgSrc + ')');
                $('.header-banner .close-large').on('click', function (event) {
                    $('body').removeClass('has-header-banner');
                });
            }

            $(window).scroll();
            $(".poster-actions-btns").clone().appendTo('.head-tools');

            //start 语言切换
            var langTime;
            $header.find('.tool-item.tool-lang, .tool-item.user-info').mouseenter(function (e) {
                clearTimeout(langTime);
                var $this = $(this);
                langTime = setTimeout(function () {
                    $this.addClass('show');
                    $header.find(".tool-item.search").removeClass('show-search').find('.i-search').removeClass('on');
                    $navMain.removeClass("show");
                    $header.removeClass('show-menu');
                }, 200);
            }).mouseleave(function (e) {
                var $this = $(this);
                clearTimeout(langTime);
                setTimeout(function () {
                    $this.removeClass('show');
                }, 200);
            });
            //end 语言切换


            $(".topbar-list li").hover(function () {
                var _this = $(this),
                    target = _this.data("target"),
                    $con = _this.closest(".all-nav");
                _this.addClass('active').siblings('li').removeClass('active');
                if (target) {
                    $con.find(".menu-boxs." + target + "").addClass("show").siblings(".menu-boxs").removeClass("show");
                    $con.find(".nav-ing").removeClass("ing");
                } else {
                    $con.find(".nav-ing").addClass("ing").find(".menu-boxs").removeClass("show");
                }
            });
        }

        //$('#service').load('pages/service.html', function() {});

        $frame.on('click', 'a[href="#toTop"]', function (event) {
            event.preventDefault();
            $('body,html').stop().animate({'scrollTop': 0}, 500, 'easeOutSine', function () {
                href_click = false;
            });
        });
        $frame.on('click', 'a[href^="#"]', function (event) {
            var target = $(this).attr("href").substr(1);
            var top = 0;
            var diff = $('#header').outerHeight();

            if($("#"+target).length > 0){
                top = $("#"+target).offset().top - diff;
            }
            else if($("[name='"+target+"']").length > 0){
                top = $("[name='"+target+"']").offset().top - diff;
            }
            event.preventDefault();
            $('body,html').stop().animate({'scrollTop': top}, 500, 'easeOutSine', function () {
                href_click = false;
            });
        });

        $(document).on('mouseenter', '.js-title', function () {
            // 增加当文字溢出再出现title属性
            if (this.scrollWidth > this.offsetWidth || this.scrollHeight > this.offsetHeight) {
                $(this).attr('title', $.trim($(this).text()));
            } else {
                $(this).attr('title', '');
            }
        });

        // 禁用的链接禁止跳转功能
        $frame.on('click', ".aui-button[disabled]", function (e) {
            e.preventDefault();
        });

        //页面右侧导航
        //var dom= document.createElement("div");
        //    $pageNav = $(dom);
        //$pageNav.load("pages/page-nav.html",function(){
        //    $(this).children("li").appendTo(".float-sidebar .float-bar-nav");
        //});


    });

    /* 分页组件插件 */
    !function ($, undefined) {
        'use strict';

        /* 客户案例index.js自带分页组件 */
        var windowHref=window.location.href;
        if(windowHref.indexOf("/cases.")!=-1){
            return;
        };

        var langMap = {
            en: {
                'total': 'Total ',
                'items': ' items',
                'goto': 'Go to',
                'pages': '',
                'go': 'Go'
            },
            cn: {
                'total': '共',
                'items': '条',
                'goto': '到第',
                'pages': '页',
                'go': '确定'
            }
        };

        // 构造函数定义
        // ===========
        var Pagination = function (selector, options) {
            this.$element = $(selector);
            this.options = {};

            var defaults = {
                lang: 'cn',
                current: 0,
                total: 0,
                items: 0,
                hrefs: []
            };

            for (var key in defaults) {
                if (options[key] === undefined) {
                    this.options[key] = defaults[key];
                } else {
                    this.options[key] = options[key]
                }
            }

            if (this.options.total === 0) return this;

            this._buildHTML();
            this._addEvent();

        };

        // 构造函数方法
        // ===========

        // 创建HTML结构
        Pagination.prototype._buildHTML = function () {
            var that = this;

            var lang = langMap[that.options.lang],
                current = that.options.current,
                total = that.options.total,
                items = that.options.items,
                hrefs = that.options.hrefs;

            var HTML = '';

            // 移动端gotoHTML
            var HTML_mbGoto = '<li class="pagination-goto-mb"><label><input type="text" class="goto-mb-input" value="' + current + '">/<span>' + total + '</span></label></li>';

            // 左、右工具栏HTML
            var HTML_leftTool = '<span class="pagination-text">' + lang.total + items + lang.items + '</span><a class="pagination-toFirst' + (current === 1 ? ' disabled' : ('" href="' + hrefs[0])) + '"></a>';
            var HTML_rightTool = '<a class="pagination-toLast' + (current === total ? ' disabled' : ('" href="' + hrefs[total - 1])) + '"></a><span class="pagination-text">' + lang.goto + '</span><input type="text" class="pagination-to">' + (that.options.lang === 'cn' ? '<span class="pagination-text">页</span>' : '') + '<input type="submit" class="pagination-submit" value="' + lang.go + '">';

            // 页码列表HTML左、右部分
            var HTML_list_before = (current === 1) ? '<ul class="pagination"><li class="disabled"><a></a></li>' : '<ul class="pagination"><li><a href="' + hrefs[current - 2] + '"></a></li>';
            var HTML_lsist_after = (current === total) ? '<li class="disabled"><a></a></li></ul>' : '<li><a href="' + hrefs[current] + '"></a></li></ul>';

            // 页码列表HTML主要部分
            var buildPageItem = function () {

                var buildStrategy = {
                    // 少于8页
                    lt: function () {
                        var HTML = '';
                        for (var i = 1; i <= total; i++) {
                            HTML += '<li' + (current === i ? ' class="active"' : '') + '><a' + (current === i ? '' : (' href="' + hrefs[i - 1]) + '"') + '>' + i + '</a></li>'
                        }

                        return HTML;
                    },
                    // 大于等于8页
                    mte: function () {
                        var i = 0,
                            max = 0;

                        var HTML_start = '',
                            HTML_center = '',
                            HTML_end = '';

                        var flag_leftEllipsis = current > 4,
                            flag_rightEllopsis = current < total - 3;

                        if (flag_leftEllipsis) {
                            HTML_start = '<li><a href="' + hrefs[0] + '">1</a></li><li class="ellipsis"><a>...</a></li>'
                        }

                        if (flag_rightEllopsis) {
                            HTML_end = '<li class="ellipsis"><a>...</a></li><li><a href="' + hrefs[total - 1] + '">' + total + '</a></li>'
                        }

                        if (flag_leftEllipsis && flag_rightEllopsis) {
                            i = current - 1;
                            max = current + 1;
                        } else if (flag_leftEllipsis && !flag_rightEllopsis) {
                            i = total - 4;
                            max = total;
                        } else if (!flag_leftEllipsis && flag_rightEllopsis) {
                            i = 1;
                            max = 5;
                        }

                        for (; i <= max; i++) {
                            HTML_center += '<li' + (current === i ? ' class="active"' : '') + '><a' + (current === i ? '' : (' href="' + hrefs[i - 1]) + '"') + '>' + i + '</a></li>'
                        }

                        return HTML_start + HTML_center + HTML_end;
                    }
                }

                if (total < 8) {
                    return buildStrategy.lt()
                } else {
                    return buildStrategy.mte()
                }
            }

            HTML = HTML_leftTool + HTML_list_before + buildPageItem() + HTML_mbGoto + HTML_lsist_after + HTML_rightTool;

            that.$element.html(HTML);
        };

        // 添加事件
        Pagination.prototype._addEvent = function () {
            var that = this;

            this.$element
            // 跳转页码
                .on('submit', function (e) {
                    e.preventDefault();

                    var pages = parseInt($(this).find('.pagination-to,.goto-mb-input').filter(':visible').val());

                    that.goto(pages);
                })
                // 移动端输入框聚焦添加样式
                .on('focus', '.goto-mb-input', function () {
                    $(this).closest('.pagination-goto-mb').addClass('on-focus');
                })
                .on('blur', '.goto-mb-input', function () {
                    $(this).closest('.pagination-goto-mb').removeClass('on-focus');
                });
        }

        // 页数跳转
        Pagination.prototype.goto = function (pages) {
            pages = parseInt(pages);

            if (isNaN(pages) || pages < 1) {
                pages = 1;
            } else if (pages > this.options.total) {
                pages = this.options.total;
            }

            location.href = this.options.hrefs[pages - 1];
        }

        // 插件
        // ====
        $.fn.pagination = function (method, options) {
            return this.each(function () {
                var $this = $(this);
                var plugin = $this.data('hw.pagination');

                if (typeof method == 'object') {
                    options = method;
                }

                if (!plugin) {
                    $this.data('hw.pagination', (plugin = new Pagination(this, options)));
                }

                if (typeof method == 'string') {
                    plugin[method](options);
                }
            });
        }
    }(jQuery);

    window.changeLang = function (lang) {
		function setCookie(name, value, expiredays) {
			var exdate, cookieString;
			exdate = new Date();
			exdate.setDate(exdate.getDate() + expiredays);
			cookieString = name + "=" + escape(value) + ((expiredays === null) ? "" : ";expires=" + exdate.toGMTString()) + ";path=/;" + "domain=.huaweicloud.com;";
			document.cookie = cookieString;
		}
        var index = "https://www.huaweicloud.com/en-us/";
        var zh = "zh-cn";
        var en = "en-us";
        var href = window.location.href;
        var host = window.location.protocol + "//" + window.location.hostname;
        var pathname = window.location.pathname;
        var hash = window.location.hash

        var url = "";
        if (lang == en) {
            if (pathname.indexOf(zh) === 1) {
                url = href.replace(zh, en);
            } else {
                url = host + "/" + en + pathname + hash;
            }
        } else {
            if (pathname.indexOf(en) === 1) {
                url = href.replace("/" + en, "");
            } else {
                url = index;
            }
        }
		setCookie('locale', lang, 30);
        if (url) {
            $.ajax({
                url: url,
                type: "get",
                success: function () {
                    window.location.href = url;
                },
                error: function (data) {
                    window.location.href = index;
                }
            });
        } else {
            window.location.href = index;
        }
    }
// $(function () {
//     $(".header-lang-item a").attr("href","javascript:changeLang('en-us');");
// });

    /* region 底部立即试用条 */
    !function () {
        var $register = $('.register-area');

        if($register.length === 0) return;

        var $registerBg = $('.register-area-bg');
        var registerHeight = $register.outerHeight();
        var maxBgMoveLength = $registerBg.outerHeight() - registerHeight;
        var maxDiff = $('body').height() - ($register.offset().top + registerHeight);
        var moveRatio = maxBgMoveLength / maxDiff;

        var setBgPosition = function () {
            var offset = $register.offset();
            var topToWindow = offset.top - $(window).scrollTop();
            var windowHeight = $(window).height();
            var diff = windowHeight - topToWindow;
            var bgMoveLength = moveRatio * diff;

            bgMoveLength = bgMoveLength < 0 ? 0 : bgMoveLength;
            bgMoveLength = bgMoveLength > maxBgMoveLength ? maxBgMoveLength : bgMoveLength;

            $registerBg.css('margin-bottom', -bgMoveLength + 'px');
        };

        setBgPosition();

        $(window).scroll(function(){
            setBgPosition();
        })
    }();
    /* endregion 底部立即试用条 */
}(jQuery);