(function($) {
  // TODO: replace url with real one
  var $recomendLinks = $("body [mate_data_rec]");
  var _RECOMMEND_STR = 'recommendation',
    _CLICK_STR = 'click';
  if ($recomendLinks.length) {
    $.ajax({
      type: 'get',
      url: '//portal.huaweicloud.com/rest/cbcairuntimeservice/v1/recommendations',
      success: function(data) {
        if (data && data.recommendations) {
          var trackId = data.trackId || '', cloudServiceTypeCode, mateDataTs;
          $(data.recommendations).each(function(index, el) {
            // cloudServiceTypeCode需要将'.'转换为'_'
            cloudServiceTypeCode = el.cloudServiceTypeCode.replace(/\./g, '_');
            mateDataTs = window.headerMatedataPrefix + _RECOMMEND_STR + '_' + trackId + '_' + cloudServiceTypeCode;

            var link = el.cloudServicePageLink || '/';
            if (link.indexOf('/') === 0 &&　link.indexOf('//') !== 0) {
              // 相对路径，加上www.huaweicloud.com域名
              link = '//www.huaweicloud.com' + link;
            }
            $("body [mate_data_rec]").eq(index).attr('href', link);
            $("body [mate_data_rec]").eq(index).attr('mate_data_ts', mateDataTs);
            $("body [mate_data_rec]").eq(index).text(el.cloudServiceName || ('recommendations' + index));
          });
        } else {
          // 没有数据，隐藏掉container
          $('.smart-recommend-container').hide();
        }
      },
      error: function(data) {
        // 请求失败，隐藏掉container
        $('.smart-recommend-container').hide();
      }
    });
  }

}(window.$));